[TOC]



# 性能测试分享



## 关于



### 工具

这里针对http接口 

- http_load (http_load)
- abench(t_search_abench)
- pap
- ab(httpd)

优点&缺点 ，使用方法  [http的get接口和post接口性能压测](http://www.atatech.org/articles/61889)



### 关注指标

- 必要
  - 性能指标 ： QPS ,RT
  - 机器指标： cpu, mem, io,load （top , tsar）
- 推荐
  - workflow上各个node的qps,rt
  - cache命中率 





## 压测准备

- 确定好自己使用的压测工具，或者依赖的压测平台
- 准备好被压测的环境
- 准备好各个场景的压测请求数据
- （非必要）程序内的打点，方便定位性能瓶颈（amonitor收集生成图表）

### 准备请求数据

请求数据与压测结果关系重大，包含了压测场景的区分以及压测结果的有效性。 通用的要求： 

- 若想要了解线上真实承载， query的分布需要与线上相似，推荐使用业务打点数据解析得出
- 需要关注缓存，若想要模拟最坏情况， 关闭缓存， 不关闭缓存的情况，关注缓存命中率 ， 尽量与线上保持一致。



## 如何进行压测？

-  **极限** ： 一个系统的承载能力，是在它达到极限时候的读数为准的 。 在开始一个系统压测的时候，我们首先要摸底，极限在哪里。

摸清极限的步骤 ： 

1.  从小并发开始 不断加大并发压测，观察压测性能指标变化趋势
2.  在到达极限之前，随着并发的不断加大， 系统的qps不断增长，rt保持稳定 。
3.  在达到极限之后， 随着并发不断加大， 系统qps增长缓慢甚至不增长或者降低， rt急速升高 

**在qps停止增长，rt开始增长这个临界点就是系统的极限**， 此时这个并发下的指标读数代表了系统的性能。



## 性能结果分析 

>  cpu 压到80% 够了
>
>    load与机器核数有关，例如是32核的，load压到 0.8*32 就差不多了， 不超过 1*32； （load代表cpu的负载情况，简单点说就是进程队列的长度）
>
>    mem 压到80% 够了
>
>    网络I/O ， 网络读写速度，实际现在最少是千兆网卡（也有万兆的）， 例如换算1000MB/8 = 125Mb/s  ， 实际达到90Mb/s 网卡就基本打满了



- 一般机器的资源优先， 系统的性能也会受到资源的限制， 以上所说的机器资源：cpu,load,内存，网络io，总有一个会首先达到极限，成为系统性能增长的**瓶颈**。 这些瓶颈可以指向后续性能优化的方案，此时可以优先通过扩容，来提升承载能力
- 当系统性能已经达到极限，但是机器资源看起来仍然有空间甚至毫无压力的时候，说明系统内部有问题，大部分可能是有锁阻塞，导致资源利用率底下，此时优先应该是排查问题，提升承载能力。





## 如何确保压测结果可信？







 















